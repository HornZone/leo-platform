<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="Calendar">
	<sql id="getSequence">
		select nextval('calendar') as id
	</sql>

	<resultMap id="CalendarResult" type="com.leo.platform.upms.entity.calendar.Calendar">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Sat Dec 17 
			22:33:39 GMT+08:00 2016. -->
		<id column="id" property="id" jdbcType="BIGINT" />
		<result column="crudType" property="crudType" jdbcType="VARCHAR" />
		<result column="code" property="code" jdbcType="VARCHAR" />
		<result column="createTime" property="createTime" jdbcType="TIMESTAMP" />
		<result column="creator" property="creator" jdbcType="VARCHAR" />
		<result column="creatorName" property="creatorName" jdbcType="VARCHAR" />
		<result column="lastUpdateTime" property="lastUpdateTime"
			jdbcType="TIMESTAMP" />
		<result column="lastUpdator" property="lastUpdator" jdbcType="VARCHAR" />
		<result column="lastUpdatorName" property="lastUpdatorName"
			jdbcType="VARCHAR" />
		<result column="version" property="version" jdbcType="VARCHAR" />
		<result column="optLock" property="optLock" jdbcType="BIGINT" />
		<result column="remark" property="remark" jdbcType="VARCHAR" />
		<result column="note" property="note" jdbcType="VARCHAR" />

		<result column="user_id" property="userId" jdbcType="BIGINT" />
		<result column="title" property="title" jdbcType="VARCHAR" />
		<result column="details" property="details" jdbcType="VARCHAR" />
		<result column="start_date" property="startDate" jdbcType="DATE" />
		<result column="length" property="length" jdbcType="INTEGER" />
		<result column="start_time" property="startTime" jdbcType="TIME" />
		<result column="end_time" property="endTime" jdbcType="TIME" />
		<result column="background_color" property="backgroundColor"
			jdbcType="VARCHAR" />
		<result column="text_color" property="textColor" jdbcType="VARCHAR" />
	</resultMap>

	<sql id="calendarColumns">
		t.id as id,
		t.crudType as crudType,
		t.code as code,
		t.createTime as
		createTime,
		t.creator as creator,
		t.creatorName as
		creatorName,
		t.lastUpdateTime as lastUpdateTime,
		t.lastUpdator as
		lastUpdator,
		t.lastUpdatorName as lastUpdatorName,
		t.version as version,
		t.optLock as
		optLock,
		t.remark as remark,
		t.note as note,

		t.user_id as
		userId,
		t.title as title,
		t.details as
		details,
		t.start_date as startDate,
		t.length as length,
		t.start_time as startTime,

		t.end_time as endTime,
		t.background_color as backgroundColor,
		t.text_color as textColor
	</sql>

	<sql id="SO_Where_Clause_Like">
		<where>
			1 = 1
			<if test=" userId !=null">
				AND t.user_id LIKE CONCAT('%',#{userId},'%')
			</if>
			<if test=" @com.leo.platform.common.util.StringUtil@isNotBlank( title ) ">
				AND t.title LIKE CONCAT('%',#{title},'%')
			</if>
			<if test="@com.leo.platform.common.util.StringUtil@isNotBlank( details )">
				AND t.details LIKE CONCAT('%',#{details},'%')
			</if>

			<if test="startDate !=null">
				AND t.start_date LIKE CONCAT('%',#{startDate},'%')
			</if>

			<if test="length !=null">
				AND t.length LIKE CONCAT('%',#{length},'%')
			</if>

			<if test="startTime !=null">
				AND t.start_time LIKE CONCAT('%',#{startTime},'%')
			</if>

			<if test="endTime !=null">
				AND t.end_time LIKE CONCAT('%',#{endTime},'%')
			</if>

			<if
				test="@com.leo.platform.common.util.StringUtil@isNotBlank( backgroundColor )">
				AND t.background_color LIKE CONCAT('%',#{backgroundColor},'%')
			</if>

			<if
				test="@com.leo.platform.common.util.StringUtil@isNotBlank( textColor )">
				AND t.text_color LIKE CONCAT('%',#{textColor},'%')
			</if>
			<include refid="common_sql" />
		</where>
	</sql>

	<sql id="SO_Where_Clause">
		<where>
			1 = 1
			<if test=" userId !=null">
				AND t.user_id = #{userId}
			</if>
			<if test=" @com.leo.platform.common.util.StringUtil@isNotBlank( title ) ">
				AND t.title = #{title}
			</if>
			<if test="@com.leo.platform.common.util.StringUtil@isNotBlank( details )">
				AND t.details = #{details}
			</if>

			<if test="startDate !=null">
				AND t.start_date = #{startDate}
			</if>

			<if test="length !=null">
				AND t.length = #{length}
			</if>

			<if test="startTime !=null">
				AND t.start_time = #{startTime}
			</if>

			<if test="endTime !=null">
				AND t.end_time = #{endTime}
			</if>

			<if
				test="@com.leo.platform.common.util.StringUtil@isNotBlank( backgroundColor )">
				AND t.background_color = #{backgroundColor}
			</if>

			<if
				test="@com.leo.platform.common.util.StringUtil@isNotBlank( textColor )">
				AND t.text_color = #{textColor}
			</if>

			<include refid="common_sql" />
		</where>
	</sql>

	<sql id="common_sql"><!-- common_sql放时间比较语句，排序语句，limit语句，between and等基本sql语句 -->
		<!-- <if test="createDate != null"> <![CDATA[and t. create_date <= #{createDate} 
			]]> </if> -->
	</sql>

	<insert id="insert" parameterType="com.leo.platform.upms.entity.calendar.Calendar">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Sat Dec 17 
			22:33:39 GMT+08:00 2016. -->
		<selectKey keyProperty="id" resultType="long" order="BEFORE">
			<include refid="getSequence" />
		</selectKey>
		insert into personal_calendar
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="crudType != null">
				crudType,
			</if>
			<if test="code != null">
				code,
			</if>
			<if test="createTime != null">
				createTime,
			</if>
			<if test="creator != null">
				creator,
			</if>
			<if test="creatorName != null">
				creatorName,
			</if>
			<if test="lastUpdateTime != null">
				lastUpdateTime,
			</if>
			<if test="lastUpdator != null">
				lastUpdator,
			</if>
			<if test="lastUpdatorName != null">
				lastUpdatorName,
			</if>
			<if test="version != null">
				version,
			</if>
			<if test="optLock != null">
				optLock,
			</if>
			<if test="remark != null">
				remark,
			</if>
			<if test="note != null">
				note,
			</if>

			<if test="userId != null">
				user_id,
			</if>
			<if test="title != null">
				title,
			</if>
			<if test="details != null">
				details,
			</if>
			<if test="startDate != null">
				start_date,
			</if>
			<if test="length != null">
				length,
			</if>
			<if test="startTime != null">
				start_time,
			</if>
			<if test="endTime != null">
				end_time,
			</if>
			<if test="backgroundColor != null">
				background_color,
			</if>
			<if test="textColor != null">
				text_color,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=BIGINT},
			</if>
			<if test="crudType != null">
				#{crudType,jdbcType=VARCHAR},
			</if>
			<if test="code != null">
				#{code,jdbcType=VARCHAR},
			</if>
			<if test="createTime != null">
				#{createTime,jdbcType=TIMESTAMP},
			</if>
			<if test="creator != null">
				#{creator,jdbcType=VARCHAR},
			</if>
			<if test="creatorName != null">
				#{creatorName,jdbcType=VARCHAR},
			</if>
			<if test="lastUpdateTime != null">
				#{lastUpdateTime,jdbcType=TIMESTAMP},
			</if>
			<if test="lastUpdator != null">
				#{lastUpdator,jdbcType=VARCHAR},
			</if>
			<if test="lastUpdatorName != null">
				#{lastUpdatorName,jdbcType=VARCHAR},
			</if>
			<if test="version != null">
				#{version,jdbcType=VARCHAR},
			</if>
			<if test="optLock != null">
				#{optLock,jdbcType=BIGINT},
			</if>
			<if test="remark != null">
				#{remark,jdbcType=VARCHAR},
			</if>
			<if test="note != null">
				#{note,jdbcType=VARCHAR},
			</if>

			<if test="userId != null">
				#{userId,jdbcType=BIGINT},
			</if>
			<if test="title != null">
				#{title,jdbcType=VARCHAR},
			</if>
			<if test="details != null">
				#{details,jdbcType=VARCHAR},
			</if>
			<if test="startDate != null">
				#{startDate,jdbcType=DATE},
			</if>
			<if test="length != null">
				#{length,jdbcType=INTEGER},
			</if>
			<if test="startTime != null">
				#{startTime,jdbcType=TIME},
			</if>
			<if test="endTime != null">
				#{endTime,jdbcType=TIME},
			</if>
			<if test="backgroundColor != null">
				#{backgroundColor,jdbcType=VARCHAR},
			</if>
			<if test="textColor != null">
				#{textColor,jdbcType=VARCHAR},
			</if>
		</trim>
	</insert>

	<delete id="delet" parameterType="java.lang.Long">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Sat Dec 17 
			22:33:39 GMT+08:00 2016. -->
		delete from personal_calendar
		where id = #{id,jdbcType=BIGINT}
	</delete>

	<update id="updateByPrimaryKeySelective" parameterType="com.leo.platform.upms.entity.calendar.Calendar">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Sat Dec 17 
			22:33:39 GMT+08:00 2016. -->
		update personal_calendar
		<set>
			<if test="crudType != null">
				crudType = #{crudType,jdbcType=VARCHAR},
			</if>
			<if test="code != null">
				code = #{code,jdbcType=VARCHAR},
			</if>
			<if test="createTime != null">
				createTime = #{createTime,jdbcType=TIMESTAMP},
			</if>
			<if test="creator != null">
				creator = #{creator,jdbcType=VARCHAR},
			</if>
			<if test="creatorName != null">
				creatorName = #{creatorName,jdbcType=VARCHAR},
			</if>
			<if test="lastUpdateTime != null">
				lastUpdateTime = #{lastUpdateTime,jdbcType=TIMESTAMP},
			</if>
			<if test="lastUpdator != null">
				lastUpdator = #{lastUpdator,jdbcType=VARCHAR},
			</if>
			<if test="lastUpdatorName != null">
				lastUpdatorName = #{lastUpdatorName,jdbcType=VARCHAR},
			</if>
			<if test="version != null">
				version = #{version,jdbcType=VARCHAR},
			</if>
			<if test="optLock != null">
				optLock = #{optLock,jdbcType=BIGINT},
			</if>
			<if test="remark != null">
				remark = #{remark,jdbcType=VARCHAR},
			</if>
			<if test="note != null">
				note = #{note,jdbcType=VARCHAR},
			</if>

			<if test="userId != null">
				user_id = #{userId,jdbcType=BIGINT},
			</if>
			<if test="title != null">
				title = #{title,jdbcType=VARCHAR},
			</if>
			<if test="details != null">
				details = #{details,jdbcType=VARCHAR},
			</if>
			<if test="startDate != null">
				start_date = #{startDate,jdbcType=DATE},
			</if>
			<if test="length != null">
				length = #{length,jdbcType=INTEGER},
			</if>
			<if test="startTime != null">
				start_time = #{startTime,jdbcType=TIME},
			</if>
			<if test="endTime != null">
				end_time = #{endTime,jdbcType=TIME},
			</if>
			<if test="backgroundColor != null">
				background_color = #{backgroundColor,jdbcType=VARCHAR},
			</if>
			<if test="textColor != null">
				text_color = #{textColor,jdbcType=VARCHAR},
			</if>
		</set>
		where id = #{id,jdbcType=BIGINT}
	</update>

	<select id="getById" parameterType="long" resultMap="CalendarResult">
		select
		<include refid="calendarColumns" />
		from personal_calendar t
		where id = #{id,jdbcType=BIGINT}
	</select>

	<select id="getAll" resultMap="CalendarResult">
		select
		<include refid="calendarColumns" />
		from personal_calendar t
	</select>

	<select id="getListByModel" parameterType="com.leo.platform.upms.model.calendar.CalendarModel"
		resultMap="CalendarResult">
		SELECT
		<include refid="calendarColumns" />
		FROM personal_calendar t
		<choose>
			<when test="like">
				<include refid="SO_Where_Clause_Like" />
			</when>
			<otherwise>
				<include refid="SO_Where_Clause" />
			</otherwise>
		</choose>
	</select>

	<select id="getCountByModel" parameterType="com.leo.platform.upms.model.calendar.CalendarModel"
		resultType="long">
		SELECT COUNT(1) FROM personal_calendar t
		<choose>
			<when test="like">
				<include refid="SO_Where_Clause_Like" />
			</when>
			<otherwise>
				<include refid="SO_Where_Clause" />
			</otherwise>
		</choose>
	</select>

	<select id="getListByIds" parameterType="List" resultMap="CalendarResult">
		SELECT
		<include refid="calendarColumns" />
		FROM personal_calendar t WHERE t.id in
		<foreach collection="list" index="index" item="item" open="("
			close=")" separator=",">
			#{item}
		</foreach>
	</select>

	<select id="getListByField" resultMap="CalendarResult">
		SELECT
		<include refid="calendarColumns" />
		FROM personal_calendar t WHERE T.${fieldName} = #{colValue}
	</select>

	<select id="countRecentlyCalendar" parameterType="com.leo.platform.upms.model.calendar.CalendarModel"
		resultType="long">
		<![CDATA[SELECT COUNT(t.id) FROM personal_calendar t

		where t.user_id=#{userId} and ((t.start_date=#{startDate}
		and (t.start_time = null or t.start_time< #{startTime}))
		or (t.start_date > #{startDate}
		and t.start_date<=( #{startDate}+ #{interval}))
		or (t.start_date< #{startDate}
		and (t.start_date+t.length)> #{startDate})
		or ((t.start_date+t.length)= #{startDate}
		and (t.end_time = null or t.end_time> #{startTime})))]]>
	</select>
</mapper>